<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <style>
        .valid { color: green; }
        .invalid { color: red; }
        .validation-icon { margin-left: 10px; }
        .error-message { color: red; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>Sign Up</h1>
    {% if error %}
    <p style="color: red;">{{ error }}</p>
    {% endif %}
    <form action="/users/signup" method="POST" enctype="multipart/form-data" onsubmit="showPopup()">
        <!-- First Name -->
        <label for="firstName">First Name:</label>
        <input type="text" id="firstName" name="firstName" required><br>

        <!-- Last Name -->
        <label for="lastName">Last Name:</label>
        <input type="text" id="lastName" name="lastName" required><br>

        <!-- Email -->
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br>
        <div id="email-error" class="error-message"></div> <!-- Placeholder for email validation error -->

        <!-- Password -->
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>
        <div>
            <p>Password must meet the following requirements:</p>
            <ul>
                <li id="length">At least 8 characters long</li>
                <li id="uppercase">At least one uppercase letter (A-Z)</li>
                <li id="lowercase">At least one lowercase letter (a-z)</li>
                <li id="number">At least one number (0-9)</li>
                <li id="special">At least one special character (!@#$%^&*)</li>
            </ul>
        </div>

        <!-- Role -->
        <!--<label for="role">Role:</label>
                <input type="number" id="role" name="role"><br>
        -->

        <!-- Phone Number -->
        <label for="phone_number">Phone Number:</label>
        <input type="number" id="phone_number" name="phone_number"><br>

        <!-- Photo Upload -->
        <label for="image">Upload Photo:</label>
        <input type="file" id="image" name="image" accept="image/*"><br>

        <!-- Submit Button -->
        <button type="submit">Sign Up</button>

        <!-- Link to Sign In Page -->
        <p>Already have an account? <a href="/users/signin">Sign In</a></p>
    </form>

    <script>
    
    function showPopup() {
      alert('Please check your email for a verification link.');
    }


        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('email-error');

        // Validate email format
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Check if email exists in the database
        async function checkEmailExists(email) {
            try {
                const response = await fetch(`/users/check-email?email=${encodeURIComponent(email)}`);
                const data = await response.json();
                return data.exists;
            } catch (error) {
                console.error('Error checking email:', error);
                return false;
            }
        }

        // Real-time email validation
        emailInput.addEventListener('input', async () => {
            const email = emailInput.value;

            // Validate email format
            if (!validateEmail(email)) {
                emailError.textContent = 'Please enter a valid email address.';
                return;
            } else {
                emailError.textContent = '';
            }

            // Check if email already exists
            const emailExists = await checkEmailExists(email);
            if (emailExists) {
                emailError.textContent = 'This email is already in use.';
            } else {
                emailError.textContent = '';
            }
        });

        // Password validation (existing code)
        const passwordInput = document.getElementById('password');
        const lengthRequirement = document.getElementById('length');
        const uppercaseRequirement = document.getElementById('uppercase');
        const lowercaseRequirement = document.getElementById('lowercase');
        const numberRequirement = document.getElementById('number');
        const specialRequirement = document.getElementById('special');

        passwordInput.addEventListener('input', () => {
            const password = passwordInput.value;

            // Validate length
            if (password.length >= 8) {
                lengthRequirement.classList.add('valid');
                lengthRequirement.classList.remove('invalid');
                lengthRequirement.innerHTML = 'At least 8 characters long <span class="validation-icon">✅</span>';
            } else {
                lengthRequirement.classList.add('invalid');
                lengthRequirement.classList.remove('valid');
                lengthRequirement.innerHTML = 'At least 8 characters long <span class="validation-icon">❌</span>';
            }

            // Validate uppercase
            if (/[A-Z]/.test(password)) {
                uppercaseRequirement.classList.add('valid');
                uppercaseRequirement.classList.remove('invalid');
                uppercaseRequirement.innerHTML = 'At least one uppercase letter (A-Z) <span class="validation-icon">✅</span>';
            } else {
                uppercaseRequirement.classList.add('invalid');
                uppercaseRequirement.classList.remove('valid');
                uppercaseRequirement.innerHTML = 'At least one uppercase letter (A-Z) <span class="validation-icon">❌</span>';
            }

            // Validate lowercase
            if (/[a-z]/.test(password)) {
                lowercaseRequirement.classList.add('valid');
                lowercaseRequirement.classList.remove('invalid');
                lowercaseRequirement.innerHTML = 'At least one lowercase letter (a-z) <span class="validation-icon">✅</span>';
            } else {
                lowercaseRequirement.classList.add('invalid');
                lowercaseRequirement.classList.remove('valid');
                lowercaseRequirement.innerHTML = 'At least one lowercase letter (a-z) <span class="validation-icon">❌</span>';
            }

            // Validate number
            if (/[0-9]/.test(password)) {
                numberRequirement.classList.add('valid');
                numberRequirement.classList.remove('invalid');
                numberRequirement.innerHTML = 'At least one number (0-9) <span class="validation-icon">✅</span>';
            } else {
                numberRequirement.classList.add('invalid');
                numberRequirement.classList.remove('valid');
                numberRequirement.innerHTML = 'At least one number (0-9) <span class="validation-icon">❌</span>';
            }

            // Validate special character
            if (/[!@#$%^&*]/.test(password)) {
                specialRequirement.classList.add('valid');
                specialRequirement.classList.remove('invalid');
                specialRequirement.innerHTML = 'At least one special character (!@#$%^&*) <span class="validation-icon">✅</span>';
            } else {
                specialRequirement.classList.add('invalid');
                specialRequirement.classList.remove('valid');
                specialRequirement.innerHTML = 'At least one special character (!@#$%^&*) <span class="validation-icon">❌</span>';
            }
        });
    </script>
</body>
</html>